import os
import subprocess
import time

# --- –ü—É—Ç–∏ –∏ –∫–æ–º–∞–Ω–¥—ã ---
backend_directory = r"C:\Users\user\Desktop\Coding\TheDailyJournal\Backend"
frontend_directory = r"C:\Users\user\Desktop\Coding\TheDailyJournal\Frontend\daily-journal"

# –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
# –í Windows –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –Ω–æ–≤–æ–≥–æ –æ–∫–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–µ—Ñ–∏–∫—Å 'start /wait' –∏–ª–∏ 'cmd /c start'
# –ó–¥–µ—Å—å –∏—Å–ø–æ–ª—å–∑—É–µ–º 'start' –≤–Ω—É—Ç—Ä–∏ –∫–æ–º–∞–Ω–¥—ã, —á—Ç–æ–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å –æ—Ç–∫—Ä—ã—Ç–∏–µ –Ω–æ–≤–æ–≥–æ –æ–∫–Ω–∞
# (—Ö–æ—Ç—è CREATE_NEW_CONSOLE —ç—Ç–æ —Å–¥–µ–ª–∞–µ—Ç, 'start' –ø–æ–ª–µ–∑–µ–Ω –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏)
run_spring_boot = "cmd /c start \"Backend Server\" mvn clean package spring-boot:run"
run_react = "cmd /c start \"Frontend Dev\" npm run dev"

# --- –ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ ---
try:
    # 1. –ó–∞–ø—É—Å–∫ Backend (Spring Boot) –≤ –Ω–æ–≤–æ–π –∫–æ–Ω—Å–æ–ª–∏
    print(f"[{time.strftime('%H:%M:%S')}] üöÄ –ó–∞–ø—É—Å–∫ Backend (Spring Boot) –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ...")
    
    # Popen –∑–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É –∏ –Ω–µ –∂–¥–µ—Ç –µ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
    backend_process = subprocess.Popen(
        run_spring_boot,
        cwd=backend_directory, # –£–∫–∞–∑—ã–≤–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –Ω–∞–ø—Ä—è–º—É—é
        shell=True,
        # –§–ª–∞–≥ CREATE_NEW_CONSOLE –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–æ –Ω–æ–≤–æ–µ –∫–æ–Ω—Å–æ–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        creationflags=subprocess.CREATE_NEW_CONSOLE 
    )
    print(f"Backend –∑–∞–ø—É—â–µ–Ω —Å PID: {backend_process.pid}")

    # –î–∞–µ–º –Ω–µ–º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ Backend –Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
    time.sleep(10) 
    print(f"[{time.strftime('%H:%M:%S')}] ‚è≥ –ü–∞—É–∑–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –ø—Ä–∏—Å—Ç—É–ø–∞–µ–º –∫ Frontend.")

    # 2. –ó–∞–ø—É—Å–∫ Frontend (React) –≤ –Ω–æ–≤–æ–π –∫–æ–Ω—Å–æ–ª–∏
    print(f"[{time.strftime('%H:%M:%S')}] üöÄ –ó–∞–ø—É—Å–∫ Frontend (React) –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ...")
    
    frontend_process = subprocess.Popen(
        run_react,
        cwd=frontend_directory, # –£–∫–∞–∑—ã–≤–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –Ω–∞–ø—Ä—è–º—É—é
        shell=True,
        # –§–ª–∞–≥ CREATE_NEW_CONSOLE –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–æ –Ω–æ–≤–æ–µ –∫–æ–Ω—Å–æ–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        creationflags=subprocess.CREATE_NEW_CONSOLE
    )
    print(f"Frontend –∑–∞–ø—É—â–µ–Ω —Å PID: {frontend_process.pid}")

    # 3. –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (–æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è, –Ω–æ –ø—Ä–æ—Ü–µ—Å—Å—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –æ–∫–Ω–∞—Ö –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å)
    print("\n-------------------------------------------------------------------------")
    print("üî• –û–±–∞ —Å–µ—Ä–≤–∏—Å–∞ –∑–∞–ø—É—â–µ–Ω—ã –≤ –û–¢–î–ï–õ–¨–ù–´–• –û–ö–ù–ê–•. –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –∑–∞–≤–µ—Ä—à–µ–Ω.")
    print("–ß—Ç–æ–±—ã –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã, –ø—Ä–æ—Å—Ç–æ –∑–∞–∫—Ä–æ–π—Ç–µ –∏—Ö —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–æ–Ω—Å–æ–ª—å–Ω—ã–µ –æ–∫–Ω–∞.")
    print("-------------------------------------------------------------------------")
    
    # –ü–æ—Å–∫–æ–ª—å–∫—É –ø—Ä–æ—Ü–µ—Å—Å—ã –∑–∞–ø—É—â–µ–Ω—ã –≤ –Ω–æ–≤—ã—Ö –æ–∫–Ω–∞—Ö (–∏—Å–ø–æ–ª—å–∑—É—è 'start' –∏ CREATE_NEW_CONSOLE), 
    # –≤–∞–º –Ω–µ –Ω—É–∂–Ω–æ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç —á–µ—Ä–µ–∑ .wait().
    # –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ—Å—Ç–æ –∑–∞–≤–µ—Ä—à–∏—Ç —Å–≤–æ—é —Ä–∞–±–æ—Ç—É.
    
except Exception as e:
    print(f"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞: {e}")
    
finally:
    # –ó–¥–µ—Å—å –Ω–µ –Ω—É–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å .terminate(), —Ç–∞–∫ –∫–∞–∫ –ø—Ä–æ—Ü–µ—Å—Å—ã –∑–∞–ø—É—â–µ–Ω—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö
    # –æ–∫–Ω–∞—Ö –∏ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —ç—Ç–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞.
    pass